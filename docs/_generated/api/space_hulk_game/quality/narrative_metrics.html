<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1"
    />
    <meta name="generator" content="pdoc3 0.11.6" />
    <title>space_hulk_game.quality.narrative_metrics API documentation</title>
    <meta
      name="description"
      content="Quality metrics for NarrativeMap evaluation …"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css"
      integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA=="
      crossorigin
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css"
      integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA=="
      crossorigin
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css"
      crossorigin
    />
    <style>
      :root {
        --highlight-color: #fe9;
      }
      .flex {
        display: flex !important;
      }
      body {
        line-height: 1.5em;
      }
      #content {
        padding: 20px;
      }
      #sidebar {
        padding: 1.5em;
        overflow: hidden;
      }
      #sidebar > *:last-child {
        margin-bottom: 2cm;
      }
      .http-server-breadcrumbs {
        font-size: 130%;
        margin: 0 0 15px 0;
      }
      #footer {
        font-size: 0.75em;
        padding: 5px 30px;
        border-top: 1px solid #ddd;
        text-align: right;
      }
      #footer p {
        margin: 0 0 0 1em;
        display: inline-block;
      }
      #footer p:last-child {
        margin-right: 30px;
      }
      h1,
      h2,
      h3,
      h4,
      h5 {
        font-weight: 300;
      }
      h1 {
        font-size: 2.5em;
        line-height: 1.1em;
      }
      h2 {
        font-size: 1.75em;
        margin: 2em 0 0.5em 0;
      }
      h3 {
        font-size: 1.4em;
        margin: 1.6em 0 0.7em 0;
      }
      h4 {
        margin: 0;
        font-size: 105%;
      }
      h1:target,
      h2:target,
      h3:target,
      h4:target,
      h5:target,
      h6:target {
        background: var(--highlight-color);
        padding: 0.2em 0;
      }
      a {
        color: #058;
        text-decoration: none;
        transition: color 0.2s ease-in-out;
      }
      a:visited {
        color: #503;
      }
      a:hover {
        color: #b62;
      }
      .title code {
        font-weight: bold;
      }
      h2[id^="header-"] {
        margin-top: 2em;
      }
      .ident {
        color: #900;
        font-weight: bold;
      }
      pre code {
        font-size: 0.8em;
        line-height: 1.4em;
        padding: 1em;
        display: block;
      }
      code {
        background: #f3f3f3;
        font-family: "DejaVu Sans Mono", monospace;
        padding: 1px 4px;
        overflow-wrap: break-word;
      }
      h1 code {
        background: transparent;
      }
      pre {
        border-top: 1px solid #ccc;
        border-bottom: 1px solid #ccc;
        margin: 1em 0;
      }
      #http-server-module-list {
        display: flex;
        flex-flow: column;
      }
      #http-server-module-list div {
        display: flex;
      }
      #http-server-module-list dt {
        min-width: 10%;
      }
      #http-server-module-list p {
        margin-top: 0;
      }
      .toc ul,
      #index {
        list-style-type: none;
        margin: 0;
        padding: 0;
      }
      #index code {
        background: transparent;
      }
      #index h3 {
        border-bottom: 1px solid #ddd;
      }
      #index ul {
        padding: 0;
      }
      #index h4 {
        margin-top: 0.6em;
        font-weight: bold;
      }
      @media (min-width: 200ex) {
        #index .two-column {
          column-count: 2;
        }
      }
      @media (min-width: 300ex) {
        #index .two-column {
          column-count: 3;
        }
      }
      dl {
        margin-bottom: 2em;
      }
      dl dl:last-child {
        margin-bottom: 4em;
      }
      dd {
        margin: 0 0 1em 3em;
      }
      #header-classes + dl > dd {
        margin-bottom: 3em;
      }
      dd dd {
        margin-left: 2em;
      }
      dd p {
        margin: 10px 0;
      }
      .name {
        background: #eee;
        font-size: 0.85em;
        padding: 5px 10px;
        display: inline-block;
        min-width: 40%;
      }
      .name:hover {
        background: #e0e0e0;
      }
      dt:target .name {
        background: var(--highlight-color);
      }
      .name > span:first-child {
        white-space: nowrap;
      }
      .name.class > span:nth-child(2) {
        margin-left: 0.4em;
      }
      .inherited {
        color: #999;
        border-left: 5px solid #eee;
        padding-left: 1em;
      }
      .inheritance em {
        font-style: normal;
        font-weight: bold;
      }
      .desc h2 {
        font-weight: 400;
        font-size: 1.25em;
      }
      .desc h3 {
        font-size: 1em;
      }
      .desc dt code {
        background: inherit;
      }
      .source > summary,
      .git-link-div {
        color: #666;
        text-align: right;
        font-weight: 400;
        font-size: 0.8em;
        text-transform: uppercase;
      }
      .source summary > * {
        white-space: nowrap;
        cursor: pointer;
      }
      .git-link {
        color: inherit;
        margin-left: 1em;
      }
      .source pre {
        max-height: 500px;
        overflow: auto;
        margin: 0;
      }
      .source pre code {
        font-size: 12px;
        overflow: visible;
        min-width: max-content;
      }
      .hlist {
        list-style: none;
      }
      .hlist li {
        display: inline;
      }
      .hlist li:after {
        content: ",\2002";
      }
      .hlist li:last-child:after {
        content: none;
      }
      .hlist .hlist {
        display: inline;
        padding-left: 1em;
      }
      img {
        max-width: 100%;
      }
      td {
        padding: 0 0.5em;
      }
      .admonition {
        padding: 0.1em 1em;
        margin: 1em 0;
      }
      .admonition-title {
        font-weight: bold;
      }
      .admonition.note,
      .admonition.info,
      .admonition.important {
        background: #aef;
      }
      .admonition.todo,
      .admonition.versionadded,
      .admonition.tip,
      .admonition.hint {
        background: #dfd;
      }
      .admonition.warning,
      .admonition.versionchanged,
      .admonition.deprecated {
        background: #fd4;
      }
      .admonition.error,
      .admonition.danger,
      .admonition.caution {
        background: lightpink;
      }
    </style>
    <style media="screen and (min-width: 700px)">
      @media screen and (min-width: 700px) {
        #sidebar {
          width: 30%;
          height: 100vh;
          overflow: auto;
          position: sticky;
          top: 0;
        }
        #content {
          width: 70%;
          max-width: 100ch;
          padding: 3em 4em;
          border-left: 1px solid #ddd;
        }
        pre code {
          font-size: 1em;
        }
        .name {
          font-size: 1em;
        }
        main {
          display: flex;
          flex-direction: row-reverse;
          justify-content: flex-end;
        }
        .toc ul ul,
        #index ul ul {
          padding-left: 1em;
        }
        .toc > ul > li {
          margin-top: 0.5em;
        }
      }
    </style>
    <style media="print">
      @media print {
        #sidebar h1 {
          page-break-before: always;
        }
        .source {
          display: none;
        }
      }
      @media print {
        * {
          background: transparent !important;
          color: #000 !important;
          box-shadow: none !important;
          text-shadow: none !important;
        }
        a[href]:after {
          content: " (" attr(href) ")";
          font-size: 90%;
        }
        a[href][title]:after {
          content: none;
        }
        abbr[title]:after {
          content: " (" attr(title) ")";
        }
        .ir a:after,
        a[href^="javascript:"]:after,
        a[href^="#"]:after {
          content: "";
        }
        pre,
        blockquote {
          border: 1px solid #999;
          page-break-inside: avoid;
        }
        thead {
          display: table-header-group;
        }
        tr,
        img {
          page-break-inside: avoid;
        }
        img {
          max-width: 100% !important;
        }
        @page {
          margin: 0.5cm;
        }
        p,
        h2,
        h3 {
          orphans: 3;
          widows: 3;
        }
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          page-break-after: avoid;
        }
      }
    </style>
    <script
      defer
      src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"
      integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ=="
      crossorigin
    ></script>
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        hljs.configure({
          languages: [
            "bash",
            "css",
            "diff",
            "graphql",
            "ini",
            "javascript",
            "json",
            "plaintext",
            "python",
            "python-repl",
            "rust",
            "shell",
            "sql",
            "typescript",
            "xml",
            "yaml",
          ],
        });
        hljs.highlightAll();
        /* Collapse source docstrings */
        setTimeout(() => {
          [...document.querySelectorAll(".hljs.language-python > .hljs-string")]
            .filter(
              (el) =>
                el.innerHTML.length > 200 &&
                ['"""', "'''"].includes(el.innerHTML.substring(0, 3)),
            )
            .forEach((el) => {
              let d = document.createElement("details");
              d.classList.add("hljs-string");
              d.innerHTML =
                '<summary>"""</summary>' + el.innerHTML.substring(3);
              el.replaceWith(d);
            });
        }, 100);
      });
    </script>
  </head>
  <body>
    <main>
      <article id="content">
        <header>
          <h1 class="title">
            Module <code>space_hulk_game.quality.narrative_metrics</code>
          </h1>
        </header>
        <section id="section-intro">
          <p>Quality metrics for NarrativeMap evaluation.</p>
          <p>
            This module defines measurable quality criteria for narrative maps
            generated by the Space Hulk Game crew, including scene connectivity,
            completeness, and structural validity.
          </p>
        </section>
        <section></section>
        <section></section>
        <section></section>
        <section>
          <h2 class="section-title" id="header-classes">Classes</h2>
          <dl>
            <dt id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics">
              <code class="flex name class">
                <span>class <span class="ident">NarrativeMetrics</span></span>
                <span>(</span
                ><span
                  >total_scenes: int = 0,<br />scenes_with_descriptions: int = 0,<br />completeness_percentage: float = 0.0,<br />all_connections_valid: bool = True,<br />has_orphaned_scenes: bool = False,<br />orphaned_scenes: list[str] = &lt;factory&gt;,<br />has_start_scene: bool = False,<br />min_scenes: int = 5,<br />min_completeness: float = 90.0)</span
                >
              </code>
            </dt>
            <dd>
              <details class="source">
                <summary>
                  <span>Expand source code</span>
                </summary>
                <pre><code class="python">@dataclass
class NarrativeMetrics:
    &#34;&#34;&#34;
    Quality metrics for evaluating narrative map content.

    Attributes:
        total_scenes: Total number of scenes in the narrative
        scenes_with_descriptions: Number of scenes that have descriptions
        completeness_percentage: Percentage of scenes with descriptions
        all_connections_valid: Whether all scene connections reference valid scenes
        has_orphaned_scenes: Whether there are unreachable scenes
        orphaned_scenes: List of orphaned scene IDs
        scene_count: Number of scenes (for threshold check)
        has_start_scene: Whether a start scene is defined
        min_scenes: Minimum required scenes (default: 5)
    &#34;&#34;&#34;

    # Measured values
    total_scenes: int = 0
    scenes_with_descriptions: int = 0
    completeness_percentage: float = 0.0
    all_connections_valid: bool = True
    has_orphaned_scenes: bool = False
    orphaned_scenes: list[str] = field(default_factory=list)
    has_start_scene: bool = False

    # Thresholds
    min_scenes: int = 5
    min_completeness: float = 90.0  # 90% of scenes should have descriptions

    def __post_init__(self):
        &#34;&#34;&#34;Initialize mutable default values.&#34;&#34;&#34;
        if self.orphaned_scenes is None:
            self.orphaned_scenes = []

    @classmethod
    def from_json_content(cls, json_content: str) -&gt; &#34;NarrativeMetrics&#34;:
        &#34;&#34;&#34;
        Create NarrativeMetrics from JSON content string.

        Args:
            json_content: JSON string containing narrative map data

        Returns:
            NarrativeMetrics instance with measured values
        &#34;&#34;&#34;
        try:
            # Handle markdown-wrapped JSON
            content = json_content.strip()
            if content.startswith(&#34;```&#34;):
                lines = content.split(&#34;\n&#34;)
                content = &#34;\n&#34;.join(lines[1:-1])
                logger.debug(&#34;Stripped markdown fences from narrative JSON&#34;)

            data = json.loads(content)
            metrics = cls.from_dict(data)

            if metrics.has_orphaned_scenes:
                logger.warning(
                    f&#34;NarrativeMetrics: Found {len(metrics.orphaned_scenes)} orphaned scenes: {metrics.orphaned_scenes}&#34;
                )

            logger.info(
                f&#34;NarrativeMetrics parsed: score={metrics.get_score():.1f}/10, passes={metrics.passes_threshold()}&#34;
            )
            return metrics
        except Exception as e:
            logger.error(f&#34;Failed to parse narrative JSON content: {e}&#34;)
            raise ValueError(f&#34;Failed to parse JSON content: {e}&#34;) from e

    @classmethod
    def from_dict(cls, data: dict[str, Any]) -&gt; &#34;NarrativeMetrics&#34;:
        &#34;&#34;&#34;
        Create NarrativeMetrics from a dictionary (parsed YAML).

        Args:
            data: Dictionary containing narrative map data

        Returns:
            NarrativeMetrics instance with measured values
        &#34;&#34;&#34;
        metrics = cls()

        # Get narrative map structure
        narrative_map = data.get(&#34;narrative_map&#34;, data)

        # Check for start scene
        metrics.has_start_scene = bool(narrative_map.get(&#34;start_scene&#34;))

        # Get scenes
        scenes = narrative_map.get(&#34;scenes&#34;, {})
        metrics.total_scenes = len(scenes)

        # Count scenes with descriptions
        for _scene_id, scene_data in scenes.items():
            if scene_data and scene_data.get(&#34;description&#34;):
                metrics.scenes_with_descriptions += 1

        # Calculate completeness percentage
        if metrics.total_scenes &gt; 0:
            metrics.completeness_percentage = (
                metrics.scenes_with_descriptions / metrics.total_scenes
            ) * 100.0

        # Validate connections
        metrics.all_connections_valid = cls._validate_connections(scenes)

        # Find orphaned scenes
        metrics.orphaned_scenes = cls._find_orphaned_scenes(
            scenes, narrative_map.get(&#34;start_scene&#34;)
        )
        metrics.has_orphaned_scenes = len(metrics.orphaned_scenes) &gt; 0

        return metrics

    @staticmethod
    def _validate_connections(scenes: dict[str, Any]) -&gt; bool:
        &#34;&#34;&#34;
        Validate that all scene connections reference valid scenes.

        Args:
            scenes: Dictionary of scenes

        Returns:
            True if all connections are valid, False otherwise
        &#34;&#34;&#34;
        scene_ids = set(scenes.keys())

        for _scene_id, scene_data in scenes.items():
            if not scene_data:
                continue

            connections = scene_data.get(&#34;connections&#34;, [])
            if not connections:
                continue

            for connection in connections:
                if isinstance(connection, dict):
                    target = connection.get(&#34;target&#34;)
                    if target and target not in scene_ids:
                        return False
                elif isinstance(connection, str):
                    if connection not in scene_ids:
                        return False

        return True

    @staticmethod
    def _find_orphaned_scenes(scenes: dict[str, Any], start_scene: str | None) -&gt; list[str]:
        &#34;&#34;&#34;
        Find scenes that are not reachable from the start scene.

        Args:
            scenes: Dictionary of scenes
            start_scene: ID of the starting scene

        Returns:
            List of orphaned scene IDs
        &#34;&#34;&#34;
        if not start_scene or start_scene not in scenes:
            # If no valid start scene, all scenes are potentially orphaned
            return list(scenes.keys())

        # Perform graph traversal to find reachable scenes (BFS)
        reachable = set()
        to_visit = deque([start_scene])

        while to_visit:
            current = to_visit.popleft()
            if current in reachable:
                continue

            reachable.add(current)

            # Get connections from current scene
            scene_data = scenes.get(current)
            if not scene_data:
                continue

            connections = scene_data.get(&#34;connections&#34;, [])
            for connection in connections:
                if isinstance(connection, dict):
                    target = connection.get(&#34;target&#34;)
                    if target and target not in reachable:
                        to_visit.append(target)
                elif isinstance(connection, str):
                    if connection not in reachable:
                        to_visit.append(connection)

        # Find orphaned scenes (all scenes minus reachable)
        all_scenes = set(scenes.keys())
        orphaned = all_scenes - reachable

        return sorted(orphaned)

    def passes_threshold(self) -&gt; bool:
        &#34;&#34;&#34;
        Check if the narrative metrics pass all quality thresholds.

        Returns:
            True if all thresholds are met, False otherwise
        &#34;&#34;&#34;
        return (
            self.has_start_scene
            and self.total_scenes &gt;= self.min_scenes
            and self.completeness_percentage &gt;= self.min_completeness
            and self.all_connections_valid
            and not self.has_orphaned_scenes
        )

    def get_failures(self) -&gt; list[str]:
        &#34;&#34;&#34;
        Get list of failed quality checks.

        Returns:
            List of failure messages for metrics that don&#39;t meet thresholds
        &#34;&#34;&#34;
        failures = []

        if not self.has_start_scene:
            failures.append(&#34;No start scene defined&#34;)

        if self.total_scenes &lt; self.min_scenes:
            failures.append(
                f&#34;Insufficient scenes: {self.total_scenes} (minimum: {self.min_scenes})&#34;
            )

        if self.completeness_percentage &lt; self.min_completeness:
            failures.append(
                f&#34;Scene descriptions incomplete: {self.completeness_percentage:.1f}% &#34;
                f&#34;(minimum: {self.min_completeness}%)&#34;
            )

        if not self.all_connections_valid:
            failures.append(&#34;Some scene connections reference invalid scenes&#34;)

        if self.has_orphaned_scenes:
            failures.append(f&#34;Orphaned scenes found: {&#39;, &#39;.join(self.orphaned_scenes)}&#34;)

        return failures

    def get_score(self) -&gt; float:
        &#34;&#34;&#34;
        Calculate overall quality score (0.0 to 10.0).

        Returns:
            Quality score based on met criteria
        &#34;&#34;&#34;
        score = 0.0

        # Start scene (2 points)
        if self.has_start_scene:
            score += 2.0

        # Minimum scenes (2 points)
        if self.total_scenes &gt;= self.min_scenes:
            score += 2.0
        elif self.total_scenes &gt; 0:
            # Partial credit
            score += 2.0 * (self.total_scenes / self.min_scenes)

        # Completeness (3 points)
        score += 3.0 * (self.completeness_percentage / 100.0)

        # Valid connections (2 points)
        if self.all_connections_valid:
            score += 2.0

        # No orphaned scenes (1 point)
        if not self.has_orphaned_scenes:
            score += 1.0

        return min(score, 10.0)

    def to_dict(self) -&gt; dict[str, Any]:
        &#34;&#34;&#34;
        Convert metrics to dictionary for serialization.

        Returns:
            Dictionary representation of metrics
        &#34;&#34;&#34;
        return {
            &#34;total_scenes&#34;: self.total_scenes,
            &#34;scenes_with_descriptions&#34;: self.scenes_with_descriptions,
            &#34;completeness_percentage&#34;: round(self.completeness_percentage, 1),
            &#34;all_connections_valid&#34;: self.all_connections_valid,
            &#34;has_orphaned_scenes&#34;: self.has_orphaned_scenes,
            &#34;orphaned_scenes&#34;: self.orphaned_scenes,
            &#34;has_start_scene&#34;: self.has_start_scene,
            &#34;passes_threshold&#34;: self.passes_threshold(),
            &#34;score&#34;: self.get_score(),
            &#34;failures&#34;: self.get_failures(),
        }</code></pre>
              </details>
              <div class="desc">
                <p>Quality metrics for evaluating narrative map content.</p>
                <h2 id="attributes">Attributes</h2>
                <dl>
                  <dt>
                    <strong><code>total_scenes</code></strong>
                  </dt>
                  <dd>Total number of scenes in the narrative</dd>
                  <dt>
                    <strong><code>scenes_with_descriptions</code></strong>
                  </dt>
                  <dd>Number of scenes that have descriptions</dd>
                  <dt>
                    <strong><code>completeness_percentage</code></strong>
                  </dt>
                  <dd>Percentage of scenes with descriptions</dd>
                  <dt>
                    <strong><code>all_connections_valid</code></strong>
                  </dt>
                  <dd>Whether all scene connections reference valid scenes</dd>
                  <dt>
                    <strong><code>has_orphaned_scenes</code></strong>
                  </dt>
                  <dd>Whether there are unreachable scenes</dd>
                  <dt>
                    <strong><code>orphaned_scenes</code></strong>
                  </dt>
                  <dd>List of orphaned scene IDs</dd>
                  <dt>
                    <strong><code>scene_count</code></strong>
                  </dt>
                  <dd>Number of scenes (for threshold check)</dd>
                  <dt>
                    <strong><code>has_start_scene</code></strong>
                  </dt>
                  <dd>Whether a start scene is defined</dd>
                  <dt>
                    <strong><code>min_scenes</code></strong>
                  </dt>
                  <dd>Minimum required scenes (default: 5)</dd>
                </dl>
              </div>
              <h3>Static methods</h3>
              <dl>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_dict"
                >
                  <code class="name flex">
                    <span>def <span class="ident">from_dict</span></span
                    >(<span
                      >data: dict[str, typing.Any]) ‑> <a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                        >NarrativeMetrics</a
                      ></span
                    >
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>
                      Create NarrativeMetrics from a dictionary (parsed YAML).
                    </p>
                    <h2 id="args">Args</h2>
                    <dl>
                      <dt>
                        <strong><code>data</code></strong>
                      </dt>
                      <dd>Dictionary containing narrative map data</dd>
                    </dl>
                    <h2 id="returns">Returns</h2>
                    <p>NarrativeMetrics instance with measured values</p>
                  </div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_json_content"
                >
                  <code class="name flex">
                    <span>def <span class="ident">from_json_content</span></span
                    >(<span
                      >json_content: str) ‑> <a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                        >NarrativeMetrics</a
                      ></span
                    >
                  </code>
                </dt>
                <dd>
                  <div class="desc">
                    <p>Create NarrativeMetrics from JSON content string.</p>
                    <h2 id="args">Args</h2>
                    <dl>
                      <dt>
                        <strong><code>json_content</code></strong>
                      </dt>
                      <dd>JSON string containing narrative map data</dd>
                    </dl>
                    <h2 id="returns">Returns</h2>
                    <p>NarrativeMetrics instance with measured values</p>
                  </div>
                </dd>
              </dl>
              <h3>Instance variables</h3>
              <dl>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.all_connections_valid"
                >
                  <code class="name"
                    >var
                    <span class="ident">all_connections_valid</span>
                    : bool</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.completeness_percentage"
                >
                  <code class="name"
                    >var
                    <span class="ident">completeness_percentage</span>
                    : float</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_orphaned_scenes"
                >
                  <code class="name"
                    >var
                    <span class="ident">has_orphaned_scenes</span> : bool</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_start_scene"
                >
                  <code class="name"
                    >var <span class="ident">has_start_scene</span> : bool</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_completeness"
                >
                  <code class="name"
                    >var
                    <span class="ident">min_completeness</span> : float</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_scenes"
                >
                  <code class="name"
                    >var <span class="ident">min_scenes</span> : int</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.orphaned_scenes"
                >
                  <code class="name"
                    >var
                    <span class="ident">orphaned_scenes</span> : list[str]</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.scenes_with_descriptions"
                >
                  <code class="name"
                    >var
                    <span class="ident">scenes_with_descriptions</span>
                    : int</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.total_scenes"
                >
                  <code class="name"
                    >var <span class="ident">total_scenes</span> : int</code
                  >
                </dt>
                <dd>
                  <div class="desc"></div>
                </dd>
              </dl>
              <h3>Methods</h3>
              <dl>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_failures"
                >
                  <code class="name flex">
                    <span>def <span class="ident">get_failures</span></span
                    >(<span>self) ‑> list[str]</span>
                  </code>
                </dt>
                <dd>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def get_failures(self) -&gt; list[str]:
    &#34;&#34;&#34;
    Get list of failed quality checks.

    Returns:
        List of failure messages for metrics that don&#39;t meet thresholds
    &#34;&#34;&#34;
    failures = []

    if not self.has_start_scene:
        failures.append(&#34;No start scene defined&#34;)

    if self.total_scenes &lt; self.min_scenes:
        failures.append(
            f&#34;Insufficient scenes: {self.total_scenes} (minimum: {self.min_scenes})&#34;
        )

    if self.completeness_percentage &lt; self.min_completeness:
        failures.append(
            f&#34;Scene descriptions incomplete: {self.completeness_percentage:.1f}% &#34;
            f&#34;(minimum: {self.min_completeness}%)&#34;
        )

    if not self.all_connections_valid:
        failures.append(&#34;Some scene connections reference invalid scenes&#34;)

    if self.has_orphaned_scenes:
        failures.append(f&#34;Orphaned scenes found: {&#39;, &#39;.join(self.orphaned_scenes)}&#34;)

    return failures</code></pre>
                  </details>
                  <div class="desc">
                    <p>Get list of failed quality checks.</p>
                    <h2 id="returns">Returns</h2>
                    <p>
                      List of failure messages for metrics that don't meet
                      thresholds
                    </p>
                  </div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_score"
                >
                  <code class="name flex">
                    <span>def <span class="ident">get_score</span></span
                    >(<span>self) ‑> float</span>
                  </code>
                </dt>
                <dd>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def get_score(self) -&gt; float:
    &#34;&#34;&#34;
    Calculate overall quality score (0.0 to 10.0).

    Returns:
        Quality score based on met criteria
    &#34;&#34;&#34;
    score = 0.0

    # Start scene (2 points)
    if self.has_start_scene:
        score += 2.0

    # Minimum scenes (2 points)
    if self.total_scenes &gt;= self.min_scenes:
        score += 2.0
    elif self.total_scenes &gt; 0:
        # Partial credit
        score += 2.0 * (self.total_scenes / self.min_scenes)

    # Completeness (3 points)
    score += 3.0 * (self.completeness_percentage / 100.0)

    # Valid connections (2 points)
    if self.all_connections_valid:
        score += 2.0

    # No orphaned scenes (1 point)
    if not self.has_orphaned_scenes:
        score += 1.0

    return min(score, 10.0)</code></pre>
                  </details>
                  <div class="desc">
                    <p>Calculate overall quality score (0.0 to 10.0).</p>
                    <h2 id="returns">Returns</h2>
                    <p>Quality score based on met criteria</p>
                  </div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.passes_threshold"
                >
                  <code class="name flex">
                    <span>def <span class="ident">passes_threshold</span></span
                    >(<span>self) ‑> bool</span>
                  </code>
                </dt>
                <dd>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def passes_threshold(self) -&gt; bool:
    &#34;&#34;&#34;
    Check if the narrative metrics pass all quality thresholds.

    Returns:
        True if all thresholds are met, False otherwise
    &#34;&#34;&#34;
    return (
        self.has_start_scene
        and self.total_scenes &gt;= self.min_scenes
        and self.completeness_percentage &gt;= self.min_completeness
        and self.all_connections_valid
        and not self.has_orphaned_scenes
    )</code></pre>
                  </details>
                  <div class="desc">
                    <p>
                      Check if the narrative metrics pass all quality
                      thresholds.
                    </p>
                    <h2 id="returns">Returns</h2>
                    <p>True if all thresholds are met, False otherwise</p>
                  </div>
                </dd>
                <dt
                  id="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.to_dict"
                >
                  <code class="name flex">
                    <span>def <span class="ident">to_dict</span></span
                    >(<span>self) ‑> dict[str, typing.Any]</span>
                  </code>
                </dt>
                <dd>
                  <details class="source">
                    <summary>
                      <span>Expand source code</span>
                    </summary>
                    <pre><code class="python">def to_dict(self) -&gt; dict[str, Any]:
    &#34;&#34;&#34;
    Convert metrics to dictionary for serialization.

    Returns:
        Dictionary representation of metrics
    &#34;&#34;&#34;
    return {
        &#34;total_scenes&#34;: self.total_scenes,
        &#34;scenes_with_descriptions&#34;: self.scenes_with_descriptions,
        &#34;completeness_percentage&#34;: round(self.completeness_percentage, 1),
        &#34;all_connections_valid&#34;: self.all_connections_valid,
        &#34;has_orphaned_scenes&#34;: self.has_orphaned_scenes,
        &#34;orphaned_scenes&#34;: self.orphaned_scenes,
        &#34;has_start_scene&#34;: self.has_start_scene,
        &#34;passes_threshold&#34;: self.passes_threshold(),
        &#34;score&#34;: self.get_score(),
        &#34;failures&#34;: self.get_failures(),
    }</code></pre>
                  </details>
                  <div class="desc">
                    <p>Convert metrics to dictionary for serialization.</p>
                    <h2 id="returns">Returns</h2>
                    <p>Dictionary representation of metrics</p>
                  </div>
                </dd>
              </dl>
            </dd>
          </dl>
        </section>
      </article>
      <nav id="sidebar">
        <div class="toc">
          <ul></ul>
        </div>
        <ul id="index">
          <li>
            <h3>Super-module</h3>
            <ul>
              <li>
                <code
                  ><a title="space_hulk_game.quality" href="index.html"
                    >space_hulk_game.quality</a
                  ></code
                >
              </li>
            </ul>
          </li>
          <li>
            <h3><a href="#header-classes">Classes</a></h3>
            <ul>
              <li>
                <h4>
                  <code
                    ><a
                      title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                      href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics"
                      >NarrativeMetrics</a
                    ></code
                  >
                </h4>
                <ul class="">
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.all_connections_valid"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.all_connections_valid"
                        >all_connections_valid</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.completeness_percentage"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.completeness_percentage"
                        >completeness_percentage</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_dict"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_dict"
                        >from_dict</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_json_content"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.from_json_content"
                        >from_json_content</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_failures"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_failures"
                        >get_failures</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_score"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.get_score"
                        >get_score</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_orphaned_scenes"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_orphaned_scenes"
                        >has_orphaned_scenes</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_start_scene"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.has_start_scene"
                        >has_start_scene</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_completeness"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_completeness"
                        >min_completeness</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_scenes"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.min_scenes"
                        >min_scenes</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.orphaned_scenes"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.orphaned_scenes"
                        >orphaned_scenes</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.passes_threshold"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.passes_threshold"
                        >passes_threshold</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.scenes_with_descriptions"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.scenes_with_descriptions"
                        >scenes_with_descriptions</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.to_dict"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.to_dict"
                        >to_dict</a
                      ></code
                    >
                  </li>
                  <li>
                    <code
                      ><a
                        title="space_hulk_game.quality.narrative_metrics.NarrativeMetrics.total_scenes"
                        href="#space_hulk_game.quality.narrative_metrics.NarrativeMetrics.total_scenes"
                        >total_scenes</a
                      ></code
                    >
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </main>
    <footer id="footer">
      <p>
        Generated by
        <a
          href="https://pdoc3.github.io/pdoc"
          title="pdoc: Python API documentation generator"
          ><cite>pdoc</cite> 0.11.6</a
        >.
      </p>
    </footer>
  </body>
</html>
